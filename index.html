<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <style>
      html,
      body {
        max-width: 100%;
        overflow-x: hidden;
      }

      #mainContent {
        overflow-x: hidden;
      }

      .scroll-wrapper {
        width: 100%;
        overflow-x: auto;
      }

      .table-container {
        width: 100%;
        table-layout: auto;
      }

      body {
        font-family: "Cairo", sans-serif;
      }

      .ltr {
        direction: ltr;
        text-align: left;
      }

      .rtl {
        direction: rtl;
        text-align: right;
      }

      .active-link {
        background-color: #f9a8d4;
        color: #831843;
        font-weight: bold;
        transition: all 0.3s ease;
      }
    </style>
  </head>

<body class="bg-gray-100 text-gray-900">
    <!-- Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
    <div
      id="backdrop"
      class="fixed inset-0 bg-black bg-opacity-50 z-30 hidden md:hidden"
      onclick="closeSidebar()"
    ></div>

    <!-- Ø²Ø± Ø§Ù„Ù‡Ø§Ù…Ø¨Ø±Ø¬Ø± ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
    <button
      id="toggleSidebar"
      class="md:hidden fixed top-4 right-4 z-50 bg-pink-600 text-white p-2 rounded-full shadow-lg"
    >
      <i data-lucide="menu"></i>
    </button>

    <div class="flex flex-col md:flex-row min-h-screen w-full">
      <!-- Sidebar -->
      <aside
        id="sidebar"
        class="fixed md:relative top-0 right-0 h-full w-64 bg-white dark:bg-gray-800 p-4 space-y-3 border-r transform transition-transform duration-300 md:translate-x-0 translate-x-full z-40"
      >
        <!-- Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
        <div class="flex justify-end md:hidden mb-4">
          <button
            onclick="closeSidebar()"
            class="text-gray-500 hover:text-pink-600 text-xl"
          >
            <i data-lucide="x"></i>
          </button>
        </div>

        <h2 class="text-xl font-bold text-pink-600 mb-4" id="sidebarTitle">
          Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </h2>
        <nav class="space-y-2">
          <button
            onclick="loadPage('home')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="home"></i
            ><span id="homeLabel" class="truncate">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span>
          </button>
          <button
            onclick="loadPage('attendance')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="calendar"></i
            ><span id="attendanceLabel" class="truncate"
              >Ø§Ù„Ø­Ø¶ÙˆØ± Ùˆ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù</span
            >
          </button>
          <button
            onclick="loadPage('leave')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="plane"></i
            ><span id="leaveLabel" class="truncate">Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¬Ø§Ø²Ø©</span>
          </button>
          <button
            onclick="loadPage('honda')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="settings"></i
            ><span id="hondaLabel" class="truncate">Ø§Ù„ØªØ³ÙƒÙŠÙ†</span>
          </button>
          <button
            onclick="loadPage('stock')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="box"></i
            ><span id="stockLabel" class="truncate">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†</span>
          </button>
          <button
            onclick="loadPage('add-employee')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="user-plus"></i
            ><span id="addEmpLabel" class="truncate">Ø£Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù</span>
          </button>
          <button
            onclick="loadPage('view-staff')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="users"></i
            ><span id="viewStaffLabel" class="truncate">Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</span>
          </button>
          <button
            onclick="loadPage('settings')"
            class="w-full flex items-center gap-2 p-2 rounded hover:bg-pink-100"
          >
            <i data-lucide="cog"></i
            ><span id="settingsLabel" class="truncate">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span>
          </button>
        </nav>
      </aside>

      <!-- Main Content -->
      <div class="flex-grow p-4 w-full" id="mainContent">
        <header class="flex items-center justify-between mb-6 mt-16 md:mt-0">
          <h1 id="pageTitle" class="text-2xl font-bold text-pink-700">
            ğŸ“Š Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
          </h1>
        </header>
        <section id="pageContent">
          <p class="text-gray-600 dark:text-gray-300">
            Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….
          </p>
        </section>
      </div>
    </div>

    <script>
      lucide.createIcons();

      const toggleButton = document.getElementById("toggleSidebar");
      const sidebar = document.getElementById("sidebar");
      const backdrop = document.getElementById("backdrop");

    toggleButton.addEventListener("click", () => {
  sidebar.classList.remove("translate-x-full", "-translate-x-full");
  sidebar.classList.add("md:translate-x-0");
  backdrop.classList.remove("hidden");
  toggleButton.classList.add("hidden");
});


      function closeSidebar() {
  const lang = localStorage.getItem("lang") || "ar";
  if (lang === "en") {
    sidebar.classList.add("-translate-x-full");
  } else {
    sidebar.classList.add("translate-x-full");
  }

  backdrop.classList.add("hidden");
  toggleButton.classList.remove("hidden");
}


      const loadingMessages = {
        ar: (page) =>
          `ğŸ“„ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© "${translations.ar.titles[page] || page}"`,
        en: (page) =>
          `ğŸ“„ Loading page "${translations.en.titles[page] || page}"`,
      };

      const translations = {
        ar: {
          sidebarTitle: "Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…",
          homeLabel: "Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
          attendanceLabel: "Ø§Ù„Ø­Ø¶ÙˆØ± Ùˆ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù",
          leaveLabel: "Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¬Ø§Ø²Ø©",
          hondaLabel: "Ø§Ù„ØªØ³ÙƒÙŠÙ†",
          stockLabel: "Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†",
          addEmpLabel: "Ø£Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù",
          viewStaffLabel: "Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",
          settingsLabel: "Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
          titles: {
            home: "ğŸ“Š Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©",
            attendance: "ğŸ“… Ø§Ù„Ø­Ø¶ÙˆØ± Ùˆ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù",
            leave: "ğŸ“ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø§Ø¬Ø§Ø²Ø©",
            honda: "ğŸ”§ Ø§Ù„ØªØ³ÙƒÙŠÙ†",
            stock: "ğŸ“¦ Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø®Ø²Ù†",
            "add-employee": "ğŸ‘¤ Ø£Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù",
            "view-staff": "ğŸ‘¥ Ø¹Ø±Ø¶ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†",
            settings: "âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª",
          },
          content: {
            home: "Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….",
            attendance:
              "<p class='text-gray-700 dark:text-gray-200'>Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØªØ§Ø¨Ø¹ Ø­Ø¶ÙˆØ± ÙˆØ§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†.</p>",
            leave:
              "<p class='text-gray-700 dark:text-gray-200'>Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¥Ø¬Ø§Ø²Ø© Ù‡ØªØ¸Ù‡Ø± Ù‡Ù†Ø§.</p>",
            honda:
              "<p class='text-gray-700 dark:text-gray-200'>Ù‚Ø³Ù… Ø§Ù„ØªØ³ÙƒÙŠÙ† Ø§Ù„Ø®Ø§Øµ Ø¨Ø§Ù„Ù…ÙˆÙ„Ø¯Ø§Øª.</p>",
            stock:
              "<p class='text-gray-700 dark:text-gray-200'>Ø£Ø¶Ù Ø£Ùˆ ØªØ§Ø¨Ø¹ Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ø¹Ø¯Ø§Øª.</p>",
            "add-employee":
              "<p class='text-gray-700 dark:text-gray-200'>Ù†Ù…ÙˆØ°Ø¬ Ù„Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯.</p>",
            "view-staff":
              "<p class='text-gray-700 dark:text-gray-200'>Ù‡Ù†Ø§ ØªÙ‚Ø¯Ø± ØªØ¹Ø±Ø¶ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†.</p>",
            settings: `<div class='flex gap-4'><select onchange="changeLang(this.value)" class="p-2 rounded bg-gray-100 dark:bg-gray-700 text-sm"><option value='ar'>ğŸ‡ªğŸ‡¬ Ø¹Ø±Ø¨ÙŠ</option><option value='en'>ğŸ‡ºğŸ‡¸ English</option></select></div>`,
          },
          filters: {
  allOffices: "Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ÙƒØ§ØªØ¨",
  downloadCSV: "ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Excel",
  viewImage: "ğŸ“· Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©",
  search: "ğŸ” Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…...",
},

          tableValues: {
            Ø´Ø¨Ø±Ø§: "Downtown",
            Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†: "Mohandsen",
            "Ø¬Ø³Ø± Ø§Ù„Ø³ÙˆÙŠØ³": "Gesr elsuiz",
            Ø­Ø¶ÙˆØ±: "Login",
            Ø§Ù†ØµØ±Ø§Ù: "Log out",
          },

          
        },
        en: {
          sidebarTitle: "Dashboard",
          homeLabel: "Home",
          attendanceLabel: "Attendance",
          leaveLabel: "Leave requests",
          hondaLabel: "Honda start",
          stockLabel: "Add to stock",
          addEmpLabel: "Add an employee",
          viewStaffLabel: "Staff View",
          settingsLabel: "Settings",
          titles: {
            home: "ğŸ“Š Home",
            attendance: "ğŸ“… Attendance",
            leave: "ğŸ“ Leave requests",
            honda: "ğŸ”§ Honda start",
            stock: "ğŸ“¦ Add to stock",
            "add-employee": "ğŸ‘¤ Add an employee",
            "view-staff": "ğŸ‘¥ Staff View",
            settings: "âš™ï¸ Settings",
          },
          content: {
            home: "Welcome to the dashboard.",
            attendance:
              "<p class='text-gray-700 dark:text-gray-200'>Here you can track employee attendance.</p>",
            leave:
              "<p class='text-gray-700 dark:text-gray-200'>Leave requests will appear here.</p>",
            honda:
              "<p class='text-gray-700 dark:text-gray-200'>Honda generator assignment section.</p>",
            stock:
              "<p class='text-gray-700 dark:text-gray-200'>Add or track equipment stock.</p>",
            "add-employee":
              "<p class='text-gray-700 dark:text-gray-200'>Form to add a new employee.</p>",
            "view-staff":
              "<p class='text-gray-700 dark:text-gray-200'>View all staff data here.</p>",
            settings: `<div class='flex gap-4'><select onchange="changeLang(this.value)" class="p-2 rounded bg-gray-100 dark:bg-gray-700 text-sm"><option value='ar'>ğŸ‡ªğŸ‡¬ Arabic</option><option value='en' selected>ğŸ‡ºğŸ‡¸ English</option></select></div>`,
          },
          filters: {
            allOffices: "All offices",
          },
          tableValues: {
            Ø´Ø¨Ø±Ø§: "Downtown",
            Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†: "Mohandsen",
            "Ø¬Ø³Ø± Ø§Ù„Ø³ÙˆÙŠØ³": "Gesr elsuiz",
            Ø­Ø¶ÙˆØ±: "Login",
            Ø§Ù†ØµØ±Ø§Ù: "Log out",
          },

          tableHeaders: {
            "Ø§Ù„ÙˆÙ‚Øª": ["Date", "Time"],
            Ø§Ù„Ø§Ø³Ù…: "Name",
            Ø§Ù„Ù…ÙƒØªØ¨: "Office",
            Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡: "Procedure",
            "Ø®Ø· Ø§Ù„Ø¹Ø±Ø¶ (Latitude)": "Latitude",
            "Ø®Ø· Ø§Ù„Ø·ÙˆÙ„ (Longitude)": "Longitude",
            "Ø§Ù„ØµÙˆØ±Ø© (Ø±Ø§Ø¨Ø·)": "Image (link)",
            "Ø³Ø¨Ø¨ Ø§Ù„Ø§Ù†ØµØ±Ø§Ù Ø§Ù„Ù…Ø¨ÙƒØ±": "Reason for early departure",
          },
          tableValues: {
            Ø­Ø¶ÙˆØ±: "Login",
            Ø§Ù†ØµØ±Ø§Ù: "Log out",
            Ø´Ø¨Ø±Ø§: "Downtown",
            Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†: "Mohandsen",
            "Ø¬Ø³Ø± Ø§Ù„Ø³ÙˆÙŠØ³": "Gesr elsuiz",
          },
          filters: {
            allOffices: "ğŸ“ All offices",
            downloadCSV: "ğŸ’¾ Download the Excel file",
            viewImage: "ğŸ“· View image",
            search: "ğŸ” Search by name...",
          },
        },
      };

let currentLang = localStorage.getItem("lang") || "ar";
      

      function changeLang(lang) {
        localStorage.setItem("lang", lang);
        currentLang = lang;
        document.documentElement.setAttribute("lang", lang);
        document.documentElement.setAttribute(
          "dir",
          lang === "ar" ? "rtl" : "ltr"
        );
        document.body.classList.toggle("rtl", lang === "ar");
        document.body.classList.toggle("ltr", lang === "en");
        
       const toggleBtn = document.getElementById("toggleSidebar");
const sidebar = document.getElementById("sidebar");

// Ø§Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„ÙƒÙ„Ø§Ø³Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ø§ØªØ¬Ø§Ù‡
sidebar.classList.remove("left-0", "right-0", "translate-x-full", "-translate-x-full");

// ØºÙŠÙ‘Ø± Ù…ÙƒØ§Ù† Ø²Ø± Ø§Ù„Ù‡Ø§Ù…Ø¨Ø±Ø¬Ø±
if (lang === "en") {
  toggleBtn.classList.remove("right-4");
  toggleBtn.classList.add("left-4");

  sidebar.classList.add("left-0", "-translate-x-full");
} else {
  toggleBtn.classList.remove("left-4");
  toggleBtn.classList.add("right-4");

  sidebar.classList.add("right-0", "translate-x-full");
}



        Object.keys(translations[lang]).forEach((id) => {
          const el = document.getElementById(id);
          if (el && typeof translations[lang][id] === "string") {
            el.textContent = translations[lang][id];
          }
        });

        const activePage =
          document.querySelector("#pageContent").getAttribute("data-page") ||
          "home";
        updatePageContent(activePage);

        if (
          document.querySelector("#pageContent").getAttribute("data-page") ===
          "attendance"
        ) {
          fetchAttendanceData(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
        }
      }

      function loadPage(page) {
        updatePageContent(page);

        // Ø´ÙŠÙ„ Ø§Ù„ØªÙ…ÙŠÙŠØ² Ù…Ù† ÙƒÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document
          .querySelectorAll("nav button")
          .forEach((btn) => btn.classList.remove("active-link"));

        // Ø­Ø¯Ø¯ Ø§Ù„Ø²Ø± Ø§Ù„Ù„ÙŠ Ø¨ÙŠØ®Øµ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        const labelId = page.replace("-", "") + "Label";
        const labelEl = document.getElementById(labelId);
        if (labelEl) {
          labelEl.parentElement.classList.add("active-link");
        }

        if (window.innerWidth < 768) {
          closeSidebar();
        }
      }

      function updatePageContent(page) {
        const title = translations[currentLang].titles[page] || page;
        let content = "";
        if (page === "attendance") {
  const loadingMsg = currentLang === "ar" ? "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª..." : "â³ Loading data...";
  content = `<div id="attendanceTable" class="py-4 text-sm text-gray-800 dark:text-white">${loadingMsg}</div>`;
} else {
          content =
            translations[currentLang].content[page] ||
            `<div class='text-gray-500 dark:text-gray-300'>${loadingMessages[
              currentLang
            ](page)}</div>`;
        }
        document.getElementById("pageTitle").textContent = title;
        const contentElement = document.getElementById("pageContent");
        contentElement.innerHTML = `<div class='py-4'>${content}</div>`;
        if (page === "attendance") fetchAttendanceData();

        contentElement.setAttribute("data-page", page);
      }

      window.onload = () => {
        if (localStorage.getItem("theme") === "dark") {
          document.documentElement.classList.add("dark");
        }
        changeLang(currentLang);
        updatePageContent("home");
      };

      const techniciansMap = {
  "Ù…Ø­Ù…Ø¯ Ø¹ØµØ§Ù… Ø£Ù†ÙˆØ± Ø­Ø³Ù†": "Mohamed Essam Anwar Hassan",
  "Ø¹Ù„Ù‰ Ø§Ø­Ù…Ø¯ Ø·Ù†Ø·Ø§ÙˆÙ‰ Ù…Ù†ØµÙˆØ±": "Ali Ahmed Tantawi Mansour",
  "Ø´Ø§Ø¯Ù‰ Ø±Ø£ÙØª Ø±ÙØ§Ø¹ÙŠ Ù…Ø­Ù…ÙˆØ¯ ØµØ§Ù„Ø­": "Shady Raafat Refai Mahmoud Saleh",
  "Ù…Ø­Ù…Ø¯ Ø­Ø³ÙŠÙ† Ù…Ø­Ù…Ø¯ Ø¹Ø§Ù…Ø±": "Mohamed Hussein Mohamed Amer",
  "Ù…ØµØ·ÙÙŠ Ø³Ø§Ù…Ù‰ Ù…ØµØ·ÙÙŠ": "Mustafa Sami Mustafa Daoud",
  "Ù…ØµØ·ÙÙ‰ Ù…Ø­Ù…ÙˆØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù†Ø¹ÙŠÙ… Ø¹Ù…Ø§Ø±": "Mustafa Mahmoud Abdel Naeem Ammar",
  "Ù…Ø­Ù…ÙˆØ¯ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ù„Ø¨Ù„ÙŠÙ‡Ù‰": "Mahmoud Mohamed Abdel Hamid Al-Buleihi",
  "Ø³Ø¹ÙŠØ¯ Ø­Ø³ÙŠÙ† Ø¹Ù„Ù‰": "Saeed Hussein Ali",
  "Ø±Ø§ÙØª Ø³ÙŠØ¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø´ÙƒÙˆØ±": "Raafat Sayed Abdel Shakoor Abdel Khaleq",
  "Ø¨Ø§Ø³Ù… Ù†Ø´Ø£Øª ØµØ§Ù„Ø­": "Bassem Nashat Saleh",
  "Ø§Ø¨Ø§Ù†ÙˆØ¨ Ø²ØºÙ„ÙˆÙ„ Ø¹Ø§Ø²Ø± Ù…ÙŠØ®Ø§Ø¦ÙŠÙ„": "Abanoub Zaghloul Azer Mikhail",
  "Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ù‡ ØªÙˆÙÙŠÙ‚ Ø§Ø¨ÙˆØ²ÙŠØ¯": "Mohamed Abdo Tawfik Abu Zeid",
  "Ù…Ø¬Ø¯Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù…Ø¬ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù†": "Magdy Abdel Hamid Ahmed Abdel Rahman",
  "Ø£Ø­Ù…Ø¯ Ø¹Ø²Øª Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…": "Ahmed Ezzat Abdel Aziz Ibrahim",
  "Ø§Ø­Ù…Ø¯ Ø¹Ù„Ù‰ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ø§ÙØ¸ Ù…Ø±Ø³Ù‰": "Ahmed Ali Abdel Hafez Morsi",
  "Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯": "Mohamed Ahmed Abdel Hamid Ahmed",
  "Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ… Ø­Ø³Ù†Ù‰ Ø¹Ø¨Ø¯Ù‡ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…": "Ibrahim Hosni Abdo Ibrahim",
  "ÙÙˆØ²Ù‰ Ù…Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø´Ø§ÙÙ‰ Ù…Ø·ÙŠØ´": "Fawzy Mohamed Abdel Shafi Matish",
  "Ø­Ø³ÙŠÙ† Ù‡Ù„Ø§Ù„ Ø­Ø³ÙŠÙ† Ù…Ø­Ù…Ø¯": "Hussein Hilal Hussein Mohamed",
  "Ø¹Ù„Ù‰ Ø­Ø³Ù† Ø¹Ù„Ù‰": "Ali Hassan Ali",
  "Ø¨Ù„Ø§Ù„ Ø±Ù…Ø¶Ø§Ù† Ù‚Ø·Ø¨ Ø­Ø³Ù†": "Bilal Ramadan Qutb Hassan",
  "Ù‡Ø§Ù†Ù‰ Ø¹Ø¨Ø¯Ø§Ù„Ø­Ù…ÙŠØ¯ Ø§Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„ÙØªØ§Ø­": "Hani Abdel Hamid Ahmed Abdel Fattah",
  "Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø§Ø­Ù…Ø¯": "Mohamed Ahmed Ahmed Mohamed Ahmed",
  "Ù†Ø§Ø¯Ø± Ù†Ø¬ÙŠØ¨ Ø­Ù†Ø§ ÙŠØ¹Ù‚ÙˆØ¨": "Nader Naguib Hanna Yacoub",
  "Ø§ÙŠÙ…Ù† Ø¬Ù…Ø§Ù„ Ø¬Ø±Ø¬Ø³ Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…": "Ayman Gamal Girgis Ibrahim",
  "Ù‡ÙŠØ«Ù… Ù…ØµØ·ÙÙ‰ Ù…ØµØ·ÙÙ‰ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ø·ÙŠÙ": "Haitham Mustafa Mustafa Abdel Latif"
};


      function fetchAttendanceData() {
        const sheetURL =
          "https://script.google.com/macros/s/AKfycby5QdbFnpkhnBFkl5el6B2rflE1HcCHTMzV2hERMhbll4veiAESm4ElsQf7Bey3sDzUAQ/exec";

        fetch(sheetURL)
          .then((res) => res.json())
          .then((data) => {
            const offices = ["Ø´Ø¨Ø±Ø§", "Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ†", "Ø¬Ø³Ø± Ø§Ù„Ø³ÙˆÙŠØ³"];
            let officeOptions = `<option value="">${translations[currentLang].filters.allOffices}</option>`;
            offices.forEach((o) => {
              const translatedOffice =
                translations[currentLang].tableValues?.[o] || o;
officeOptions += `<option value="${o}">${translatedOffice}</option>`;
            });

            let filters = `
<div class="mb-4 flex flex-col md:flex-row items-center gap-4 md:gap-2 justify-start flex-wrap">

    <!-- ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„ÙÙ†ÙŠ -->
    <input type="text" id="searchInput" placeholder="${translations[currentLang].filters.search}"
" 
      class="w-full md:w-1/3 p-2 border rounded shadow text-sm text-gray-800 dark:text-white dark:bg-gray-800 dark:border-gray-600">
    <!-- ğŸ¢ Ø§Ù„ÙÙ„ØªØ± Ø¨Ø§Ù„Ù…ÙƒØªØ¨ -->
    
   <select id="officeFilter" 
  class="w-full md:w-1/4 p-2 border rounded shadow text-sm text-gray-800 dark:text-white dark:bg-gray-800 dark:border-gray-600">
  ${officeOptions}
</select>


    <!-- ğŸ’¾ Ø²Ø± ØªØ­Ù…ÙŠÙ„ CSV -->
    <button onclick="exportTableToCSV('attendance.csv')" 
      class="p-2 bg-pink-600 text-white rounded hover:bg-pink-700 text-sm shadow">
${translations[currentLang].filters.downloadCSV}
    </button>

  </div>
`;

            const container = document.getElementById("attendanceTable");
            if (!data || data.length === 0) {
              container.innerHTML = "âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø¶ÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹.";
              return;
            }

            let table = `
<div class="w-full overflow-x-auto border rounded shadow min-h-[400px] h-[80vh]">

<table class="min-w-max w-full bg-white dark:bg-gray-800 text-sm text-right border border-gray-300 dark:border-gray-700">
      <thead class="bg-pink-600 text-white sticky top-0 z-10">
        <tr>`;

            // ğŸ§  Ø§Ù„Ù‡ÙŠØ¯Ø±: Ù„Ùˆ ÙÙŠÙ‡ Ø¹Ù…ÙˆØ¯ ÙˆÙ‚Øª ÙˆØªØ§Ø±ÙŠØ® Ù†Ù‚Ø³Ù…Ù‡ Ù„Ø¹Ù…ÙˆØ¯ÙŠÙ†
            Object.keys(data[0]).forEach((key) => {
              if (
                key === "Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª" ||
                key.toLowerCase().includes("time")
              ) {
                const headers = translations[currentLang].tableHeaders[key] || [
                  "Date",
                  "Time",
                ];
                table += `<th class="px-4 py-2 text-center">ğŸ“… ${headers[0]}</th>`;
                table += `<th class="px-4 py-2 text-center">â° ${headers[1]}</th>`;
              } else {
                const translated =
                  translations[currentLang].tableHeaders?.[key] || key;
                table += `<th class="px-4 py-2 text-center">${translated}</th>`;
              }
            });

            table += `</tr></thead><tbody class="text-gray-700 dark:text-gray-200">`;

            // ğŸ§  Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            data.forEach((row) => {
const officeName = row["Ø§Ù„Ù…ÙƒØªØ¨"];
table += `<tr class="border-b border-gray-200 dark:border-gray-700 hover:bg-pink-50 dark:hover:bg-gray-700" data-office="${officeName}">`;

              Object.entries(row).forEach(([key, val]) => {
                if (
                  key === "Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª" ||
                  key.toLowerCase().includes("time")
                ) {
                  const date = new Date(val);
                  const formattedDate = date.toLocaleDateString("ar-EG");
                  const formattedTime = date.toLocaleTimeString("ar-EG", {
                    hour: "2-digit",
                    minute: "2-digit",
                  });
                  table += `<td class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-center">${formattedDate}</td><td class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-center">${formattedTime}</td>`;
                } else if (
                  typeof val === "string" &&
                  (val.startsWith("http://") || val.startsWith("https://")) &&
                  (val.includes("drive.google.com") ||
                    val.match(/\.(jpg|jpeg|png|gif|webp)(\?|$)/i))
                ) {
                  table += `<td class="px-4 py-2 border border-gray-300 dark:border-gray-700 text-center text-blue-600 underline"><a href="${val}" target="_blank">ğŸ“· ${currentLang === "ar" ? "Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©" : "View Image"}</a>
</td>`;
                } else {
                  let translatedVal = val;

// Ù„Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
if (translations[currentLang].tableValues?.[val]) {
  translatedVal = translations[currentLang].tableValues[val];
// Ù„Ùˆ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ø³Ù… ÙÙ†ÙŠ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ø§Ù„Ù…Ø§Ø¨
} else if (currentLang === "en") {
  // Ù†Ø­Ø§ÙˆÙ„ Ù†Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¹Ø¯ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª
  if (typeof val === "string") {
  const trimmedVal = val.trim();
  if (techniciansMap[trimmedVal]) {
    translatedVal = techniciansMap[trimmedVal];
  }
}

}



                  table += `<td class="px-4 py-2 border border-gray-300 dark:border-gray-700 bg-gray-100 dark:bg-gray-700 text-center">${translatedVal}</td>`;
                }
              });

              table += `</tr>`;
            });

            table += `</tbody></table></div>`;
            container.innerHTML = filters + table;
            // ğŸ§  ØªØ­Ø¯ÙŠØ¯ Ø±Ù‚Ù… Ø¹Ù…ÙˆØ¯ Ø§Ù„Ù…ÙƒØªØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
            const headerCells = document.querySelectorAll(
              "#attendanceTable table thead th"
            );
            let officeColumnIndex = -1;
            headerCells.forEach((th, index) => {
              const title = th.textContent.trim();
              if (title.includes("Ø§Ù„Ù…ÙƒØªØ¨")) {
                officeColumnIndex = index;
              }
            });

           document.getElementById("officeFilter").addEventListener("change", function () {
  const value = this.value.trim();
  const rows = document.querySelectorAll("#attendanceTable table tbody tr");
  rows.forEach((row) => {
    const office = row.getAttribute("data-office");
    row.style.display = !value || office === value ? "" : "none";
  });
});


            // ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù…
            document
              .getElementById("searchInput")
              .addEventListener("input", function () {
                const value = this.value.trim().toLowerCase();
                const rows = document.querySelectorAll(
                  "#attendanceTable table tbody tr"
                );
                rows.forEach((row) => {
                  const text = row.textContent.toLowerCase();
                  row.style.display = text.includes(value) ? "" : "none";
                });
              });
          })
          .catch((err) => {
            document.getElementById("attendanceTable").innerHTML =
              "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
            console.error("Fetch error:", err);
          });
      }

      function exportTableToCSV(filename) {
        const rows = document.querySelectorAll("#attendanceTable table tr");
        let csv = [];
        rows.forEach((row) => {
          const cols = row.querySelectorAll("td, th");
          let rowData = [];
          cols.forEach((col) => {
            rowData.push(col.innerText.replace(/,/g, "ØŒ")); // Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„ÙÙˆØ§ØµÙ„
          });
          csv.push(rowData.join(","));
        });
        const csvContent =
          "data:text/csv;charset=utf-8,\uFEFF" + csv.join("\n");
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", filename);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }
    </script>
  </body>
</html>
